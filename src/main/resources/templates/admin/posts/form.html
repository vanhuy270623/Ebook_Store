<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
	<th:block th:replace="~{admin/layout/head :: head}"></th:block>
	<script src="https://cdn.ckeditor.com/4.20.1/standard/ckeditor.js"></script>
	<style>
		.image-preview { max-width: 200px; max-height: 200px; margin-top: 10px; display: none; }
	</style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
	<div th:replace="~{admin/layout/header :: header}"></div>
	<div th:replace="~{admin/layout/sidebar :: sidebar}"></div>

	<div class="content-wrapper">
		<section class="content-header">
			<h1><span th:if="${isEdit}">Chỉnh sửa bài viết</span><span th:unless="${isEdit}">Viết bài mới</span></h1>
			<ol class="breadcrumb">
				<li><a th:href="@{/admin/dashboard}"><i class="fa fa-dashboard"></i> Dashboard</a></li>
				<li><a th:href="@{/admin/posts}">Quản lý bài viết</a></li>
				<li class="active" th:text="${isEdit} ? 'Chỉnh sửa' : 'Viết mới'"></li>
			</ol>
		</section>

		<section class="content">
			<div class="row" th:if="${error}">
				<div class="col-md-12">
					<div class="alert alert-danger alert-dismissible">
						<button type="button" class="close" data-dismiss="alert">×</button>
						<span th:text="${error}"></span>
					</div>
				</div>
			</div>

			<form th:action="@{${isEdit ? '/admin/posts/update' : '/admin/posts/create'}}" th:object="${postRequest}" method="post" enctype="multipart/form-data">
				<input type="hidden" th:if="${isEdit}" th:field="*{postId}"/>
				<div class="row">
					<div class="col-md-8">
						<div class="box box-primary">
							<div class="box-body">
								<div class="form-group">
									<label for="title">Tiêu đề <span style="color:red;">*</span></label>
									<input type="text" class="form-control" id="title" th:field="*{title}" placeholder="Tiêu đề bài viết" maxlength="255" required>
								</div>

								<div class="form-group">
									<label for="slug">Slug <span style="color:red;">*</span></label>
									<input type="text" class="form-control" id="slug" th:field="*{slug}" placeholder="title-of-post" maxlength="255" required>
								</div>

								<div class="form-group">
									<label for="excerpt">Tóm tắt</label>
									<textarea class="form-control" id="excerpt" th:field="*{excerpt}" rows="3" maxlength="500"></textarea>
								</div>

								<div class="form-group">
									<label for="content">Nội dung <span style="color:red;">*</span></label>
									<textarea class="form-control" id="content" th:field="*{content}" rows="10" required></textarea>
									<script>
										CKEDITOR.replace( 'content' );
									</script>
								</div>
							</div>
						</div>
					</div>

					<div class="col-md-4">
						<div class="box box-info">
							<div class="box-header">
								<h3 class="box-title">Hình ảnh bìa</h3>
							</div>
							<div class="box-body">
								<div th:if="${isEdit && post != null && post.thumbnailUrl}">
									<img th:src="${post.thumbnailUrl}" style="max-width: 100%;">
									<p class="text-muted text-center">Hình hiện tại</p>
								</div>

								<div class="form-group">
									<label for="thumbnailFile">Tải lên hình</label>
									<input type="file" id="thumbnailFile" class="form-control" accept="image/*" onchange="previewImage(this)">
									<img id="imagePreview" class="image-preview">
								</div>

								<div class="form-group">
									<label for="thumbnailUrl">Hoặc nhập URL</label>
									<input type="text" class="form-control" id="thumbnailUrl" th:field="*{thumbnailUrl}" maxlength="500">
								</div>
							</div>
						</div>

						<div class="box box-warning">
							<div class="box-header">
								<h3 class="box-title">Tùy chọn</h3>
							</div>
							<div class="box-body">
								<div class="form-group">
									<label>
										<input type="checkbox" th:field="*{isPublished}" />
										Xuất bản
									</label>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="box-footer">
					<button type="submit" class="btn btn-primary"><i class="fa fa-save"></i> Lưu</button>
					<a th:href="@{/admin/posts}" class="btn btn-secondary"><i class="fa fa-times"></i> Hủy</a>
				</div>
			</form>
		</section>
	</div>

	<div th:replace="~{admin/layout/footer :: footer}"></div>
</div>

<th:block th:replace="~{admin/layout/scripts :: scripts}"></th:block>
<script>
	function previewImage(input) {
		if (input.files && input.files[0]) {
			var reader = new FileReader();
			reader.onload = function(e) {
				document.getElementById('imagePreview').src = e.target.result;
				document.getElementById('imagePreview').style.display = 'block';
			};
			reader.readAsDataURL(input.files[0]);
		}
	}
</script>
</body>
</html>

