<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<th:block th:replace="~{admin/layout/head :: head}"></th:block>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
	<div th:replace="~{admin/layout/header :: header}"></div>

	<div th:replace="~{admin/layout/sidebar :: sidebar}"></div>

	<div class="content-wrapper">
		<section class="content-header">
			<h1>
				Chi tiết người dùng
				<small th:text="${user?.fullName ?: user?.username}">Tên người dùng</small>
			</h1>
			<ol class="breadcrumb">
				<li><a th:href="@{/admin/dashboard}"><i class="fa fa-tachometer"></i> Dashboard</a></li>
				<li><a th:href="@{/admin/users}">Quản lý người dùng</a></li>
				<li class="active">Chi tiết</li>
			</ol>
		</section>

		<section class="content">
			<div class="row" th:if="${success} or ${error}">
				<div class="col-md-12">
					<div class="alert alert-success alert-dismissible" th:if="${success}">
						<button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
						<i class="icon fa fa-check"></i> <span th:text="${success}"></span>
					</div>
					<div class="alert alert-danger alert-dismissible" th:if="${error}">
						<button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
						<i class="icon fa fa-ban"></i> <span th:text="${error}"></span>
					</div>
				</div>
			</div>

			<div class="row" th:if="${user}">
				<div class="col-md-4">
					<div class="box box-primary">
						<div class="box-header with-border">
							<h3 class="box-title">Thông tin cá nhân</h3>
						</div>
						<div class="box-body box-profile">
							<img class="profile-user-img img-responsive img-circle"
								 th:src="${user.avatarUrl != null && !user.avatarUrl.isEmpty() ? user.avatarUrl : '/admin_template/images/user-default.png'}"
								 th:alt="${user.fullName ?: user.username}"
								 style="width:100px; height:100px; object-fit:cover;">

							<h3 class="profile-username text-center" th:text="${user.fullName ?: user.username}">Tên người dùng</h3>

							<p class="text-muted text-center">
								<span th:if="${user.role != null}">
									<span th:if="${user.role.roleName.name() == 'ADMIN'}" class="label label-danger">
										<i class="fa fa-shield"></i> Administrator
									</span>
									<span th:if="${user.role.roleName.name() == 'USER'}" class="label label-primary">
										<i class="fa fa-user"></i> Người dùng
									</span>
								</span>
							</p>

							<ul class="list-group list-group-unbordered">
								<li class="list-group-item">
									<b><i class="fa fa-envelope"></i> Email</b>
									<span class="pull-right" th:text="${user.email}">email@example.com</span>
								</li>
								<li class="list-group-item">
									<b><i class="fa fa-phone"></i> Số điện thoại</b>
									<span class="pull-right" th:text="${user.phone ?: 'Chưa cập nhật'}">Chưa cập nhật</span>
								</li>
								<li class="list-group-item">
									<b><i class="fa fa-calendar"></i> Ngày đăng ký</b>
									<span class="pull-right" th:text="${#temporals.format(user.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2024</span>
								</li>
								<li class="list-group-item">
									<b><i class="fa fa-clock-o"></i> Lần cuối đăng nhập</b>
									<span class="pull-right">
										<span th:if="${user.lastLogin}" th:text="${#temporals.format(user.lastLogin, 'dd/MM/yyyy HH:mm')}">Never</span>
										<span th:if="${!user.lastLogin}" class="text-muted">Chưa đăng nhập</span>
									</span>
								</li>
							</ul>

							<div class="row">
								<div class="col-sm-6">
									<div class="text-center">
										<span th:if="${user.isActive}" class="label label-success" style="font-size: 12px;">
											<i class="fa fa-check-circle"></i> Đang hoạt động
										</span>
										<span th:if="${!user.isActive}" class="label label-danger" style="font-size: 12px;">
											<i class="fa fa-times-circle"></i> Đã bị khóa
										</span>
									</div>
								</div>
								<div class="col-sm-6">
									<div class="text-center">
										<span th:if="${user.isVerified}" class="label label-info" style="font-size: 12px;">
											<i class="fa fa-certificate"></i> Đã xác thực
										</span>
										<span th:if="${!user.isVerified}" class="label label-warning" style="font-size: 12px;">
											<i class="fa fa-exclamation-triangle"></i> Chưa xác thực
										</span>
									</div>
								</div>
							</div>

							<div style="margin-top: 20px;" th:if="${user.role?.roleName?.name() != 'ADMIN'}">
								<a th:href="@{/admin/users/edit/{id}(id=${user.userId})}" class="btn btn-warning btn-block">
									<i class="fa fa-pencil"></i> Chỉnh sửa thông tin
								</a>

								<form th:action="@{/admin/users/toggle-status/{id}(id=${user.userId})}" method="post" style="margin-top: 5px;">
									<button type="submit" class="btn btn-block"
											th:classappend="${user.isActive} ? 'btn-danger' : 'btn-success'"
											onclick="return confirm('Bạn có chắc chắn muốn thay đổi trạng thái tài khoản này?')">
										<i class="fa" th:classappend="${user.isActive} ? 'fa-lock' : 'fa-unlock'"></i>
										<span th:text="${user.isActive} ? 'Khóa tài khoản' : 'Kích hoạt tài khoản'">Action</span>
									</button>
								</form>
							</div>
						</div>
					</div>
				</div>

				<div class="col-md-8">
					<div class="nav-tabs-custom">
						<ul class="nav nav-tabs">
							<li class="active"><a href="#activity" data-toggle="tab">Hoạt động</a></li>
							<li><a href="#orders" data-toggle="tab">Đơn hàng</a></li>
						</ul>
						<div class="tab-content">
							<div class="active tab-pane" id="activity">
								<div class="box-body">
									<h4><i class="fa fa-history"></i> Lịch sử hoạt động</h4>
									<div class="timeline">
										<div class="time-label">
											<span class="bg-blue" th:text="${#temporals.format(user.createdAt, 'dd/MM/yyyy')}">Ngày tạo</span>
										</div>
										<div>
											<i class="fa fa-user-plus bg-blue"></i>
											<div class="timeline-item">
												<span class="time"><i class="fa fa-clock-o"></i>
													<span th:text="${#temporals.format(user.createdAt, 'HH:mm')}">01/01/2024</span>
												</span>
												<h3 class="timeline-header">Tạo tài khoản</h3>
												<div class="timeline-body">
													Tài khoản được tạo và đăng ký thành công.
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>

							<div class="tab-pane" id="orders">
								<div class="box-body">
									<h4><i class="fa fa-shopping-bag"></i> Lịch sử đơn hàng</h4>
									<p class="text-muted">Chưa có dữ liệu đơn hàng.</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="row" th:if="${!user}">
				<div class="col-md-12">
					<div class="box box-danger">
						<div class="box-header with-border">
							<h3 class="box-title">Lỗi</h3>
						</div>
						<div class="box-body">
							<p>Không tìm thấy người dùng với ID này.</p>
							<a th:href="@{/admin/users}" class="btn btn-primary">
								<i class="fa fa-arrow-left"></i> Quay lại danh sách
							</a>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>

	<div th:replace="~{admin/layout/footer :: footer}"></div>
</div>

<th:block th:replace="~{admin/layout/scripts :: scripts}"></th:block>
</body>
</html>